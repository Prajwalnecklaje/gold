<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pendo Hash Routing Repro</title>

  <script>
    const visitors = [
      "test_user_01",
      "test_user_02",
      "test_user_03",
      "test_user_04",
      "test_user_05",
      "test_user_06",
      "test_user_07",
      "test_user_08",
      "test_user_09",
      "test_user_10",
      "Vignesh",
      "Rakshith"
    ];

    let index = localStorage.getItem("visitorIndex");
    index = index ? (parseInt(index) + 1) % visitors.length : 0;
    localStorage.setItem("visitorIndex", index);

    window.visitorId = visitors[index];
    console.log("Pendo Visitor ID:", window.visitorId);
  </script>

  <!-- Pendo Snippet -->
  <script>
    (function(apiKey){
      (function(p,e,n,d,o){
        var v,w,x,y,z;o=p[d]=p[d]||{};
        o._q=o._q||[];v=['initialize','identify','updateOptions','pageLoad','track'];
        for(w=0,x=v.length;w<x;++w)(function(m){
          o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};
        })(v[w]);
        y=e.createElement(n);y.async=!0;
        y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];
        z.parentNode.insertBefore(y,z);
      })(window,document,'script','pendo');

      // ‚ùå Intentionally DO NOT initialize on legacy hash route
      function initPendoIfAllowed() {
        if (window.location.hash === '#/signin') {
          console.warn('Pendo NOT initialized on legacy login route');
          return;
        }

        pendo.initialize({
          visitor: { id: window.visitorId },
          account: { id: "test_account_001" }
        });

        console.log('Pendo initialized');
      }

      initPendoIfAllowed();

      // Re-check on hash change (simulates SPA behavior)
      window.addEventListener('hashchange', initPendoIfAllowed);

    })('043f5c9d-f8b2-4d0f-7fd8-6020c3074f67');
  </script>

  <style>
    body { font-family: Arial, sans-serif; padding: 40px; }
    button { margin: 10px; padding: 10px 20px; }
    .route { margin-top: 30px; font-weight: bold; }
  </style>
</head>
<body>

  <h1>Pendo Hash-Based Login Repro</h1>

  <button onclick="location.hash='/'">Home</button>
  <button onclick="location.hash='/signin'">Legacy Login (#/signin)</button>

  <div class="route" id="routeView"></div>

  <script>
    function renderRoute() {
      const view = document.getElementById('routeView');

      if (location.hash === '#/signin') {
        view.innerHTML = 'üîê Legacy Login Page (Pendo not initialized)';
      } else {
        view.innerHTML = 'üè† Home Page (Pendo initialized)';
      }
    }

    window.addEventListener('hashchange', renderRoute);
    renderRoute();
  </script>

</body>
</html>
