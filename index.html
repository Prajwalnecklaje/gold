<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Legacy Hash Login Reproduction</title>

  <style>
    body { font-family: Arial; padding: 40px; }
    button { margin: 10px; padding: 10px 20px; }
  </style>

  <!-- Load Pendo Agent (but DO NOT initialize yet) -->
  <script>
    (function(apiKey){
      (function(p,e,n,d,o){
        var v,w,x,y,z;o=p[d]=p[d]||{};
        o._q=o._q||[];
        v=['initialize','identify','updateOptions','pageLoad','track'];
        for(w=0,x=v.length;w<x;++w)(function(m){
          o[m]=o[m]||function(){
            o._q[m===v[0]?'unshift':'push'](
              [m].concat([].slice.call(arguments,0))
            );
          };
        })(v[w]);
        y=e.createElement(n);y.async=!0;
        y.src='https://cdn.pendo.io/agent/static/YOUR_API_KEY/pendo.js';
        z=e.getElementsByTagName(n)[0];
        z.parentNode.insertBefore(y,z);
      })(window,document,'script','pendo');
    })('043f5c9d-f8b2-4d0f-7fd8-6020c3074f67');
  </script>

</head>
<body>

  <h1>Legacy App</h1>

  <a href="#/signin">Go to Legacy Login</a> |
  <a href="#/home">Go to Home</a>

  <div id="app"></div>

  <script>
    let isLoggedIn = false;

    function renderRoute() {
      const route = window.location.hash;
      const app = document.getElementById("app");
      app.innerHTML = "";

      if (route === "#/signin") {

        // Login page (NO pendo.initialize here)
        app.innerHTML = `
          <h2>Legacy Login Page</h2>
          <button onclick="login()">Login</button>
        `;

      } else {

        app.innerHTML = `
          <h2>Home Page</h2>
          <p>User is logged in</p>
        `;

        // Initialize Pendo ONLY after login
        if (isLoggedIn && !window.pendoInitialized) {
          window.pendoInitialized = true;

          pendo.initialize({
            visitor: { id: "logged_in_user" },
            account: { id: "test_account" }
          });

          console.log("Pendo initialized after login");
        }
      }
    }

    function login() {
      isLoggedIn = true;
      window.location.hash = "#/home";
    }

    window.addEventListener("hashchange", renderRoute);
    window.addEventListener("load", renderRoute);
  </script>

</body>
</html>
